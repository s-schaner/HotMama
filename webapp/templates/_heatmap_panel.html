<div class="grid grid-cols-1 gap-6">
  <section class="card bg-base-100 shadow">
    <div class="card-body space-y-4">
      <div>
        <h2 class="card-title">Video → Heatmap Pipeline</h2>
        <p class="text-sm opacity-70">Pick a detection strategy and rendering stack to build a ball trajectory heatmap directly from video without running the full LLM analysis.</p>
      </div>

      <form id="heatmap-pipeline-form"
            hx-post="/_api/heatmap_pipeline"
            hx-encoding="multipart/form-data"
            hx-target="#heatmap-pipeline-results"
            hx-swap="innerHTML"
            hx-on::after-request="if(event.detail.successful){showToast('Pipeline finished', 'success');}"
            onsubmit="showToast('Running heatmap pipeline...', 'info')">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <label class="form-control">
            <span class="label-text">Video file</span>
            <input type="file" name="video" class="file-input file-input-bordered w-full" accept="video/*" required />
          </label>

          <label class="form-control">
            <span class="label-text">Detection method</span>
            <select name="method" class="select select-bordered">
              {% for option in detection_methods %}
              <option value="{{ option }}" {% if option == 'auto' %}selected{% endif %}>{{ option }}</option>
              {% endfor %}
            </select>
          </label>

          <label class="form-control">
            <span class="label-text">Frame stride</span>
            <input type="number" min="1" name="stride" value="2" class="input input-bordered" />
            <span class="label-text-alt">Process every Nth frame for speed.</span>
          </label>

          <label class="form-control">
            <span class="label-text">Smoothing window</span>
            <input type="number" min="1" name="smoothing" value="3" class="input input-bordered" />
            <span class="label-text-alt">Moving average window over detected points.</span>
          </label>

          <label class="form-control">
            <span class="label-text">Min confidence</span>
            <input type="number" min="0" max="1" step="0.01" name="min_confidence" value="0.05" class="input input-bordered" />
          </label>

          <label class="form-control">
            <span class="label-text">Overlay outputs</span>
            <select name="overlay" class="select select-bordered">
              <option value="true" selected>Generate overlays</option>
              <option value="false">Skip overlays</option>
            </select>
          </label>
        </div>

        <div class="mt-4">
          <span class="label-text font-semibold">Heatmap renderers</span>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mt-2">
            {% for renderer in renderers %}
            <label class="label cursor-pointer justify-start gap-2">
              <input type="checkbox" name="renderers" value="{{ renderer }}" class="checkbox checkbox-sm" checked />
              <span class="label-text capitalize">{{ renderer }}</span>
            </label>
            {% endfor %}
          </div>
          <span class="label-text-alt">At least three rendering methods are available; deselect any you do not need.</span>
        </div>

        <div class="card-actions justify-end mt-4">
          <button class="btn btn-primary" type="submit">Run Heatmap Pipeline</button>
        </div>
      </form>

      <div id="heatmap-pipeline-results" class="space-y-4"></div>
    </div>
  </section>

  <section class="card bg-base-100 shadow">
    <div class="card-body">
      <h2 class="card-title">Render from CSV</h2>
      <p class="text-sm opacity-70">Upload a CSV with <code>x,y,h</code> columns to render a court heatmap.</p>
      <form action="/heatmap" method="post" enctype="multipart/form-data" target="_blank" class="card bg-base-100 shadow p-4 space-y-3" onsubmit="showToast('Rendering heatmap...', 'info')">
        <input type="file" name="csvfile" class="file-input file-input-bordered w-full" accept=".csv" required />

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
          <label class="form-control">
            <span class="label-text">Theme</span>
            <select name="theme" class="select select-bordered">
              <option value="dark" selected>dark</option>
              <option value="light">light</option>
            </select>
          </label>

          <label class="form-control">
            <span class="label-text">Colormap</span>
            <select name="colormap" class="select select-bordered">
              <option value="magma" selected>magma</option>
              <option value="plasma">plasma</option>
              <option value="inferno">inferno</option>
              <option value="turbo">turbo</option>
              <option value="mintred">mint→red</option>
            </select>
          </label>

          <label class="form-control">
            <span class="label-text">Density Scale</span>
            <input type="number" step="0.1" name="density_scale" value="1.0" class="input input-bordered" />
          </label>

          <label class="form-control">
            <span class="label-text">Blur σ ×</span>
            <input type="number" step="0.1" name="density_sigma" value="1.0" class="input input-bordered" />
          </label>

          <label class="form-control">
            <span class="label-text">Contours</span>
            <select name="show_contours" class="select select-bordered">
              <option value="True" selected>on</option>
              <option value="False">off</option>
            </select>
          </label>

          <label class="form-control">
            <span class="label-text">Trail</span>
            <select name="draw_trail" class="select select-bordered">
              <option value="True" selected>on</option>
              <option value="False">off</option>
            </select>
          </label>

          <label class="form-control">
            <span class="label-text">Trail Width (px)</span>
            <input type="number" step="1" min="1" name="trail_width_px" value="10" class="input input-bordered" />
          </label>
        </div>

        <div class="card-actions justify-end">
          <button class="btn btn-secondary" type="submit">Generate Sexy Heatmap</button>
        </div>
      </form>
    </div>
  </section>
</div>
