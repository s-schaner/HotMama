<div class="space-y-6">
  <!-- Header -->
  <div class="flex justify-between items-start">
    <div>
      <h3 class="font-bold text-2xl">{{ session.title }}</h3>
      <div class="text-sm opacity-70 mt-1">
        <span class="badge badge-ghost">{{ session.id[:12] }}...</span>
        <span class="mx-2">•</span>
        <time>{{ session.created_utc }}</time>
        {% if session.venue %}
        <span class="mx-2">•</span>
        <span>{{ session.venue }}</span>
        {% endif %}
      </div>
    </div>
    <button
      class="btn btn-sm btn-ghost"
      onclick="document.getElementById('session_editor_modal').close()">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <div class="divider"></div>

  <!-- Session Statistics Overview -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="stat bg-base-200 rounded-lg">
      <div class="stat-figure text-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
        </svg>
      </div>
      <div class="stat-title">Total Events</div>
      <div class="stat-value text-primary">{{ rollup_summary.total_events }}</div>
      <div class="stat-desc">Across all clips</div>
    </div>

    <div class="stat bg-base-200 rounded-lg">
      <div class="stat-figure text-secondary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
        </svg>
      </div>
      <div class="stat-title">Video Clips</div>
      <div class="stat-value text-secondary">{{ clips|length }}</div>
      <div class="stat-desc">Uploaded and analyzed</div>
    </div>

    <div class="stat bg-base-200 rounded-lg">
      <div class="stat-figure text-accent">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
      </div>
      <div class="stat-title">Event Types</div>
      <div class="stat-value text-accent">{{ rollup_summary.event_types|length }}</div>
      <div class="stat-desc">Unique actions tracked</div>
    </div>
  </div>

  <!-- Tabs for different sections -->
  <div role="tablist" class="tabs tabs-bordered">
    <input type="radio" name="session_tabs" role="tab" class="tab" aria-label="Teams & Rosters" checked />
    <div role="tabpanel" class="tab-content p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Team A -->
        <div class="card bg-base-200">
          <div class="card-body">
            <h4 class="card-title">Team A</h4>
            <div class="form-control">
              <label class="label">
                <span class="label-text">Team Name</span>
              </label>
              <input
                type="text"
                value="{{ teams.A or 'Not set' }}"
                class="input input-bordered"
                readonly />
            </div>

            <div class="divider">Roster</div>

            {% if rosters.A %}
            <div class="overflow-x-auto">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Player Name</th>
                  </tr>
                </thead>
                <tbody>
                  {% for player in rosters.A %}
                  <tr>
                    <td><span class="badge badge-primary">{{ player.number }}</span></td>
                    <td>{{ player.player_name }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
              <span class="text-xs">No roster set for Team A</span>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Team B -->
        <div class="card bg-base-200">
          <div class="card-body">
            <h4 class="card-title">Team B</h4>
            <div class="form-control">
              <label class="label">
                <span class="label-text">Team Name</span>
              </label>
              <input
                type="text"
                value="{{ teams.B or 'Not set' }}"
                class="input input-bordered"
                readonly />
            </div>

            <div class="divider">Roster</div>

            {% if rosters.B %}
            <div class="overflow-x-auto">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Player Name</th>
                  </tr>
                </thead>
                <tbody>
                  {% for player in rosters.B %}
                  <tr>
                    <td><span class="badge badge-secondary">{{ player.number }}</span></td>
                    <td>{{ player.player_name }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="alert alert-warning">
              <span class="text-xs">No roster set for Team B</span>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <input type="radio" name="session_tabs" role="tab" class="tab" aria-label="Video Clips" />
    <div role="tabpanel" class="tab-content p-6">
      {% if clips %}
      <div class="space-y-3">
        {% for clip in clips %}
        <div class="card bg-base-200">
          <div class="card-body p-4">
            <div class="flex justify-between items-center">
              <div class="flex-1">
                <h5 class="font-semibold">{{ clip.path }}</h5>
                <div class="text-xs opacity-70 mt-1">
                  <span>Duration: {{ "%.1f"|format(clip.duration_sec) }}s</span>
                  <span class="mx-2">•</span>
                  <span class="badge badge-ghost badge-xs">{{ clip.id[:8] }}...</span>
                </div>
              </div>
              <div class="flex gap-2">
                <button class="btn btn-sm btn-ghost" title="View details">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>No video clips in this session yet</span>
      </div>
      {% endif %}
    </div>

    <input type="radio" name="session_tabs" role="tab" class="tab" aria-label="Statistics" />
    <div role="tabpanel" class="tab-content p-6">
      <div class="space-y-6">
        <!-- Event Types Breakdown -->
        <div class="card bg-base-200">
          <div class="card-body">
            <h4 class="card-title">Event Types</h4>
            {% if rollup_summary.event_types %}
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
              {% for event_type, count in rollup_summary.event_types.items() %}
              <div class="stat bg-base-100 rounded p-3">
                <div class="stat-title text-xs">{{ event_type }}</div>
                <div class="stat-value text-2xl">{{ count }}</div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <p class="text-sm opacity-70">No events recorded yet</p>
            {% endif %}
          </div>
        </div>

        <!-- Team Performance -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {% for team_side, team_data in rollup_summary.teams.items() %}
          <div class="card bg-base-200">
            <div class="card-body">
              <h5 class="card-title text-lg">Team {{ team_side }}</h5>
              <div class="stat bg-base-100 rounded">
                <div class="stat-title">Total Actions</div>
                <div class="stat-value text-3xl">{{ team_data.events }}</div>
              </div>

              {% if team_data.types %}
              <div class="divider text-xs">Breakdown</div>
              <div class="space-y-1">
                {% for event_type, count in team_data.types.items() %}
                <div class="flex justify-between text-sm">
                  <span class="opacity-70">{{ event_type }}</span>
                  <span class="font-semibold">{{ count }}</span>
                </div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <input type="radio" name="session_tabs" role="tab" class="tab" aria-label="Settings" />
    <div role="tabpanel" class="tab-content p-6">
      <form
        hx-patch="/_api/sessions/{{ session.id }}"
        hx-target="#session-editor-content"
        hx-swap="outerHTML"
        hx-on::after-request="if(event.detail.successful){showToast('Session updated', 'success');}"
        class="space-y-4">

        <div class="form-control">
          <label class="label">
            <span class="label-text">Session Title</span>
          </label>
          <input type="text" name="title" value="{{ session.title }}" class="input input-bordered" required />
        </div>

        <div class="form-control">
          <label class="label">
            <span class="label-text">Venue</span>
          </label>
          <input type="text" name="venue" value="{{ session.venue or '' }}" class="input input-bordered" />
        </div>

        <div class="divider">Danger Zone</div>

        <div class="card bg-error bg-opacity-10 border border-error">
          <div class="card-body">
            <h5 class="card-title text-error">Delete Session</h5>
            <p class="text-sm opacity-70">This action will delete the session and all associated data. A backup will be created automatically.</p>
            <div class="card-actions justify-end">
              <button
                type="button"
                class="btn btn-error btn-sm"
                hx-delete="/_api/sessions/{{ session.id }}"
                hx-confirm="Are you sure you want to delete this session? This action cannot be undone."
                hx-on::after-request="if(event.detail.successful){showToast('Session deleted', 'info'); document.getElementById('session_editor_modal').close(); window.location.reload();}">
                Delete Session
              </button>
            </div>
          </div>
        </div>

        <div class="card-actions justify-end border-t pt-4">
          <button type="button" class="btn" onclick="document.getElementById('session_editor_modal').close()">Close</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>
