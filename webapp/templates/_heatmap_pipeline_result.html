<div class="card bg-base-100 shadow">
  <div class="card-body space-y-4">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
      <h2 class="card-title">Heatmap Pipeline Result</h2>
      <span class="badge badge-outline">{{ method }}</span>
    </div>

    <p class="text-sm opacity-80">Detected {{ points_count }} points. CSV export:
      {% if csv_url %}
      <a class="link link-primary" href="{{ csv_url }}" target="_blank">download</a>
      {% else %}
      <span class="opacity-60">unavailable</span>
      {% endif %}
    </p>

    {% if preview %}
    <div class="overflow-x-auto">
      <table class="table table-xs">
        <thead>
          <tr>
            <th>t (s)</th>
            <th>x (m)</th>
            <th>y (m)</th>
            <th>h</th>
            <th>confidence</th>
            <th>frame</th>
          </tr>
        </thead>
        <tbody>
          {% for row in preview %}
          <tr>
            <td>{{ row.t }}</td>
            <td>{{ row.x }}</td>
            <td>{{ row.y }}</td>
            <td>{{ row.h }}</td>
            <td>{{ row.confidence }}</td>
            <td>{{ row.frame }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <span class="label-text-alt">Showing first {{ preview|length }} points.</span>
    </div>
    {% endif %}

    {% if heatmaps %}
    <div class="grid grid-cols-1 md:grid-cols-{{ heatmaps|length if heatmaps|length < 3 else 3 }} gap-4">
      {% for entry in heatmaps %}
      <div class="space-y-2">
        <h3 class="font-semibold capitalize">{{ entry.name }} renderer</h3>
        <img src="{{ entry.url }}" alt="Heatmap {{ entry.name }}" class="rounded border border-base-300" />
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-warning">
      <span>No heatmaps were rendered. Check dependency logs below.</span>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      {% if overlay_url %}
      <div class="space-y-2">
        <h3 class="font-semibold">Video overlay</h3>
        <video src="{{ overlay_url }}" class="w-full rounded border border-base-300" controls preload="metadata"></video>
      </div>
      {% endif %}

      {% if topdown_url %}
      <div class="space-y-2">
        <h3 class="font-semibold">Court playback</h3>
        <video src="{{ topdown_url }}" class="w-full rounded border border-base-300" controls preload="metadata"></video>
      </div>
      {% endif %}
    </div>

    {% if snapshot_url %}
    <div class="space-y-2">
      <h3 class="font-semibold">Trajectory snapshot</h3>
      <img src="{{ snapshot_url }}" class="rounded border border-base-300" alt="Trajectory snapshot" />
    </div>
    {% endif %}

    {% if logs %}
    <div class="divider">Logs</div>
    <ul class="list-disc list-inside text-xs">
      {% for line in logs %}
      <li>{{ line }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>
</div>
